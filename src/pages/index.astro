---
import BaseLayout from '../layouts/BaseLayout.astro';
import ProjectCard from '../components/ProjectCard.astro';
import { projects } from '../data/projects';
import { getCollection } from 'astro:content';

const featuredProjects = projects.filter(p => p.featured && !p.draft);

const allPosts = await getCollection('blog', ({ data }) => !data.draft);
const recentPosts = allPosts
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);
---

<BaseLayout title="Matt Donders">
  <!-- Hero -->
  <section class="hero">
    <div class="container hero-content">
      <div class="hero-label">
        <span class="status-dot"></span>
        <span>Building things</span>
      </div>
      <h1 class="hero-name">
        Matt Donders
      </h1>
      <p class="hero-tagline">
        Software developer building iOS apps, Cloudflare Workers,
        and whatever else seems interesting.
      </p>
      <div class="hero-links">
        <a href="https://github.com/mattdonders" class="btn btn-primary" target="_blank" rel="noopener noreferrer">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z"/>
          </svg>
          GitHub
        </a>
        <a href="https://twitter.com/mattdonders" class="btn btn-outline" target="_blank" rel="noopener noreferrer">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
          </svg>
          Twitter / X
        </a>
        <a href="/about" class="btn btn-outline">About me &rarr;</a>
      </div>
    </div>
  </section>

  <!-- Featured Projects -->
  <section class="section">
    <div class="container">
      <div class="section-header section-header-row">
        <div>
          <span class="section-label">// projects</span>
          <h2>What I'm building</h2>
        </div>
        <a href="/projects" class="btn btn-outline">All projects &rarr;</a>
      </div>

      <div class="grid-cards">
        {featuredProjects.map(project => (
          <ProjectCard project={project} />
        ))}
      </div>
    </div>
  </section>

  <!-- Recent Blog Posts -->
  {recentPosts.length > 0 && (
    <section class="section section-alt">
      <div class="container">
        <div class="section-header section-header-row">
          <div>
            <span class="section-label">// writing</span>
            <h2>Recent posts</h2>
          </div>
          <a href="/blog" class="btn btn-outline">All posts &rarr;</a>
        </div>

        <div class="post-list">
          {recentPosts.map(post => (
            <a href={`/blog/${post.slug}`} class="post-row">
              <div class="post-row-content">
                <h3 class="post-row-title">{post.data.title}</h3>
                <p class="post-row-desc">{post.data.description}</p>
              </div>
              <time class="post-row-date" datetime={post.data.pubDate.toISOString()}>
                {post.data.pubDate.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' })}
              </time>
            </a>
          ))}
        </div>
      </div>
    </section>
  )}
</BaseLayout>

<style>
  /* === Hero === */
  .hero {
    padding: 6rem 0 5rem;
    border-bottom: 1px solid var(--border);
  }

  .hero-content {
    max-width: 680px;
  }

  .hero-label {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    font-family: var(--font-mono);
    font-size: 0.8rem;
    color: var(--text-subtle);
    margin-bottom: 1.25rem;
  }

  .status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--success);
    box-shadow: 0 0 0 2px rgba(74, 222, 128, 0.25);
    animation: pulse 2.5s ease-in-out infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50%       { opacity: 0.5; }
  }

  .hero-name {
    margin-bottom: 1rem;
    background: linear-gradient(135deg, var(--text) 0%, var(--text-muted) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .hero-tagline {
    font-size: 1.15rem;
    color: var(--text-muted);
    max-width: 55ch;
    margin-bottom: 2rem;
  }

  .hero-links {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
  }

  /* === Section variants === */
  .section-header-row {
    display: flex;
    align-items: flex-end;
    justify-content: space-between;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .section-alt {
    background: var(--surface);
    border-top: 1px solid var(--border);
    border-bottom: 1px solid var(--border);
  }

  /* === Post list === */
  .post-list {
    display: flex;
    flex-direction: column;
    gap: 0;
  }

  .post-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 2rem;
    padding: 1.25rem 0;
    border-bottom: 1px solid var(--border);
    text-decoration: none;
    transition: padding-left 0.15s ease;
  }

  .post-row:first-child {
    border-top: 1px solid var(--border);
  }

  .post-row:hover {
    padding-left: 0.5rem;
  }

  .post-row-content {
    flex: 1;
    min-width: 0;
  }

  .post-row-title {
    font-size: 1rem;
    font-weight: 600;
    color: var(--text);
    margin-bottom: 0.2rem;
    transition: color 0.15s ease;
  }

  .post-row:hover .post-row-title {
    color: var(--accent);
  }

  .post-row-desc {
    font-size: 0.875rem;
    color: var(--text-muted);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    margin: 0;
  }

  .post-row-date {
    font-family: var(--font-mono);
    font-size: 0.775rem;
    color: var(--text-subtle);
    white-space: nowrap;
    flex-shrink: 0;
  }

  @media (max-width: 600px) {
    .hero { padding: 3rem 0 3rem; }
    .post-row { flex-direction: column; align-items: flex-start; gap: 0.25rem; }
  }
</style>
